!function(){document.sdmcd=!document.sdmcd;let e,t,n,d,a,o,s,c=5,l=5,r="#FF0000",m=!1,u=!1,h=!1,p=!1,g=[],f=[],b=[],x=0,y=!1,v=!1,w=!1;function F(){P(),document.sdmcdKeyAborter.abort(),document.getElementById("sdmcd-canvas")?.remove(),document.getElementById("sdmcd-popup-bg")?.remove();for(const e of document.getElementsByClassName("sdmcd-text-input"))e.remove()}function k(e){e.preventDefault()}function I(e){document.getElementById("sdmcd-popup-bg")||e.target.classList.contains("sdmcd-text-input")||(0!==e.button&&void 0!==e.button||(s.lineWidth=c,s.globalCompositeOperation="source-over",S(),m=!0),2===e.button&&(s.lineWidth=Math.max(1.5*c,30),w?(s.fillStyle="#FFFFFF",s.strokeStyle="#FFFFFF",s.globalCompositeOperation="source-over"):s.globalCompositeOperation="destination-out",u=!0,R()),1===e.button?(!function(e,t){const n=document.createElement("div");n.contentEditable=!0,n.type="text",n.classList.add("sdmcd-text-input"),n.style.color=r,n.style.fontSize=2.5*l+20+"px",n.style.top=t-1.5*l-15+"px",n.style.left=e+"px",n.id="sdmcd-text-input-"+Date.now(),document.body.appendChild(n),n.focus(),n.addEventListener("focus",(()=>{g.push({textId:n.id,text:n.textContent}),f=[]})),n.addEventListener("pointerdown",(e=>{2===e.button&&(e.preventDefault(),n.classList.toggle("removed"),g.push({textId:n.id}),f=[])})),g.push({textId:n.id})}(e.clientX,e.clientY),e.preventDefault()):g.push({data:s.getImageData(0,0,o.width,o.height)}),f=[],b.push({x:e.clientX,y:e.clientY}))}function E(e){m&&y&&1===b.length?function(e,t){const n=g[g.length-1];s.putImageData(n.data,0,0);const d=[[e,t]],i=s.getImageData(0,0,o.width,o.height),a=l(e,t),c=m(r);if(a.r===c.r&&a.g===c.g&&a.b===c.b)return;for(;d.length;){const[e,t]=d.pop();let n=4*(t*o.width+e),i=t;for(;i>=0&&u(n);)i--,n-=4*o.width;n+=4*o.width,i++;let a=!1,s=!1;for(;i<o.height&&u(n);)h(n),e>0&&(u(n-4)?a||(d.push([e-1,i]),a=!0):a&&(a=!1)),e<o.width-1&&(u(n+4)?s||(d.push([e+1,i]),s=!0):s&&(s=!1)),i++,n+=4*o.width}function l(e,t){const n=4*(t*o.width+e);return{r:i.data[n],g:i.data[n+1],b:i.data[n+2],a:i.data[n+3]}}function m(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:255}}function u(e){const t=i.data[e],n=i.data[e+1],d=i.data[e+2],o=i.data[e+3];if(o>0&&o<255)return!0;if(t===a.r&&n===a.g&&d===a.b)return!0;const s=Math.abs(a.r-c.r)/Math.abs(t-a.r),l=Math.abs(a.g-c.g)/Math.abs(n-a.g),r=Math.abs(a.b-c.b)/Math.abs(d-a.b),m=[];return isNaN(s)||m.push(s),isNaN(l)||m.push(l),isNaN(r)||m.push(r),m.length>0&&m.every(((e,t,n)=>e===n[0]))&&1!=m[0]}function h(e){i.data[e]=c.r,i.data[e+1]=c.g,i.data[e+2]=c.b,i.data[e+3]=c.a}s.putImageData(i,0,0)}(e.clientX,e.clientY):C(e),m&&(m=!1),u&&(u=!1,n.classList.add("sdmcd-fading")),b=[]}function C(d){if(n){let e=c;n.classList.contains("sdmcd-erasing")&&(e=Math.max(1.5*c,30)),n.style.top=d.clientY-e/2-1+"px",n.style.left=d.clientX-e/2-1+"px"}e=d.clientX,t=d.clientY,(m||u)&&(v=!0,b.push({x:d.clientX,y:d.clientY}),L())}function L(){m?0!==x||y?0===x&&y?(A(),s.beginPath(),s.moveTo(b[0].x,b[0].y),s.lineTo(b[b.length-1].x,b[b.length-1].y),s.stroke()):1!==x||y?1===x&&y?function(){A();const e=b[0].x,t=b[0].y,n=(Math.abs(b[0].x-b[b.length-1].x)+Math.abs(b[0].y-b[b.length-1].y))/2,d=b[0].x<b[b.length-1].x?n:-n,i=b[0].y<b[b.length-1].y?n:-n;s.strokeRect(e,t,d,i)}():2!==x||y?2===x&&y&&function(){A();const e=b[0].x,t=b[0].y,n=Math.min(Math.abs(b[0].x-b[b.length-1].x),Math.abs(b[0].y-b[b.length-1].y))/2,d=b[0].x<b[b.length-1].x?n:-n,i=b[0].y<b[b.length-1].y?n:-n;s.beginPath(),s.ellipse(e+d,t+i,n,n,0,0,2*Math.PI),s.stroke()}():function(){A();const e=Math.min(b[0].x,b[b.length-1].x),t=Math.min(b[0].y,b[b.length-1].y),n=Math.abs(b[0].x-b[b.length-1].x),d=Math.abs(b[0].y-b[b.length-1].y);s.beginPath(),s.ellipse(e+n/2,t+d/2,n/2,d/2,0,0,2*Math.PI),s.stroke()}():function(){A();const e=Math.min(b[0].x,b[b.length-1].x),t=Math.min(b[0].y,b[b.length-1].y),n=Math.abs(b[0].x-b[b.length-1].x),d=Math.abs(b[0].y-b[b.length-1].y);s.strokeRect(e,t,n,d)}():function(){if(A(),b.length<4){var e=b[0];s.beginPath(),s.arc(e.x,e.y,s.lineWidth/2,0,2*Math.PI,!0),s.closePath(),s.fill()}else{for(s.beginPath(),s.moveTo(b[0].x,b[0].y),i=1;i<b.length-2;i++){const e=(b[i].x+b[i+1].x)/2,t=(b[i].y+b[i+1].y)/2;s.quadraticCurveTo(b[i].x,b[i].y,e,t)}s.quadraticCurveTo(b[i].x,b[i].y,b[i+1].x,b[i+1].y),s.stroke()}}():u&&function(){if(b.length<4){var e=b[0];return s.beginPath(),s.arc(e.x,e.y,s.lineWidth/2,0,2*Math.PI,!0),s.closePath(),void s.fill()}const t=b[b.length-4],n=b[b.length-2],d=b[b.length-1];s.beginPath(),s.moveTo(t.x,t.y),s.quadraticCurveTo(d.x,d.y,n.x,n.y),s.stroke()}()}function M(e){if(e.preventDefault(),document.activeElement.classList.contains("sdmcd-text-input"))return e.deltaY>0?l-=1:l+=1,l<1&&(l=1),void(document.activeElement.style.fontSize=2.5*l+20+"px");e.shiftKey&&(a&&document.body.contains(a)||(e.deltaY>0?c-=1:c+=1,c<1&&(c=1),s.lineWidth=c,l=c,R(),L()))}function A(){const e=g[g.length-1].data;s.putImageData(e,0,0)}function T(e){e.preventDefault()}function S(){s.strokeStyle=r,s.fillStyle=r}function D(e){w=!w,s.globalCompositeOperation="source-over";const t=document.querySelectorAll(".sdmcd-text-input:not(.removed)"),n=[...t].map((e=>e.id));t.forEach((e=>e.classList.add("removed"))),w?(e&&g.push({switch:!0,activeTextInputs:n,data:s.getImageData(0,0,o.width,o.height)}),s.fillStyle="#FFFFFF",s.fillRect(0,0,o.width,o.height),r="#000000",S()):(e&&g.push({switch:!0,activeTextInputs:n,data:s.getImageData(0,0,o.width,o.height)}),r="#FF0000",S(),s.clearRect(0,0,o.width,o.height)),f=[]}function B(){document.sdmcdMouseAborter=new AbortController,window.addEventListener("contextmenu",k,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointerdown",I,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointerup",E,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("pointermove",C,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("dragstart",T,{signal:document.sdmcdMouseAborter.signal}),window.addEventListener("wheel",M,{passive:!1,signal:document.sdmcdMouseAborter.signal}),document.body.style.touchAction="none"}function P(){document.sdmcdMouseAborter.abort(),document.body.style.touchAction="auto"}function R(){n||(n=document.createElement("div"),n.id="sdmcd-brush-outline",document.body.appendChild(n)),n.classList.remove("sdmcd-fading"),u||n.classList.remove("sdmcd-erasing"),clearTimeout(d);let i=c;u&&(i=Math.max(1.5*c,30),n.classList.add("sdmcd-erasing")),n.style.top=t-i/2-1+"px",n.style.left=e-i/2-1+"px",n.style.width=i+"px",n.style.height=i+"px",u||(d=setTimeout((()=>{n.classList.add("sdmcd-fading")}),500))}function z(){const e=document.createElement("div");e.id="sdmcd-popup-bg",e.addEventListener("click",(t=>{t.target==e&&e.remove()}));const t=document.createElement("div");return t.id="sdmcd-popup-content",e.appendChild(t),document.body.appendChild(e),a=e,t}document.sdmcd?(!function(){if(document.getElementById("sdmcd-css"))return;const e=document.createElement("style");e.id="sdmcd-css",e.innerHTML="#sdmcd-canvas{position:fixed;top:0;left:0;z-index:9999997;cursor:crosshair}.sdmcd-hidden #sdmcd-canvas,.sdmcd-hidden .sdmcd-text-input,.sdmcd-text-input.removed{display:none}.sdmcd-unfocused #sdmcd-canvas,.sdmcd-unfocused .sdmcd-text-input{pointer-events:none}#sdmcd-popup-bg{position:fixed;top:0;left:0;z-index:9999999;width:100vw;height:100vh;background-color:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;font-size:1vw;color:#fff;font-family:Helvetica,sans-serif}#sdmcd-popup-content{display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none}#sdmcd-help-bg{display:flex;width:45em;background-color:#2b2b2e;color:#fff;font-family:Arial,sans-serif;font-size:min(1.25em, 2vw, 2vh);padding:1em 2.5em;gap:3em;pointer-events:all;border-radius:.5em}#sdmcd-help-left,#sdmcd-help-right{flex:1;padding:1em}#sdmcd-help-bg #sdmcd-help-left{flex:1.7}#sdmcd-help-bg h3{font-size:1.3em;margin-bottom:.8em}.sdmcd-help-line{display:flex;justify-content:space-between;height:1.5em;border-bottom:1px solid #ffffff22;margin:.2em 0}.sdmcd-help-line code{background-color:#222124;padding:.1em .3em;border-radius:.2em;text-transform:uppercase}#sdmcd-color-content{font-size:2em;display:flex;flex-direction:column;align-items:center;gap:.2em}#sdmcd-color{width:20em;height:20em;border-radius:1em;padding:0;border:none;outline:0;cursor:pointer;pointer-events:auto}#sdmcd-color::-webkit-color-swatch-wrapper{padding:0}#sdmcd-color::-webkit-color-swatch{border:none;border-radius:.5em}#sdmcd-brush-outline{position:fixed;border-radius:50%;border:1px solid #888;pointer-events:none;z-index:9999998}#sdmcd-brush-outline.sdmcd-fading{opacity:0;transition:opacity .5s}.sdmcd-text-input{position:fixed;z-index:9999998;outline:0;border-right:1px solid transparent;font-family:Arial,Helvetica,sans-serif;font-weight:400}",document.head.appendChild(e)}(),o=document.createElement("canvas"),o.id="sdmcd-canvas",o.width=window.innerWidth,o.height=window.innerHeight,document.body.appendChild(o),s=o.getContext("2d",{willReadFrequently:!0}),s.lineWidth=c,s.lineJoin="round",s.lineCap="round",S(),B(),document.sdmcdKeyAborter=new AbortController,window.addEventListener("keydown",(function(e){let t,n=!0;if("Escape"===e.key&&document.activeElement.classList.contains("sdmcd-text-input"))return void document.activeElement.blur();if(document.activeElement.classList.contains("sdmcd-text-input")&&!e.ctrlKey)return;if(!(!h&&!p||"F1"==e.key&&(h||p)||"f"==e.key&&h))return;y&&(v=!0);"Shift"!==e.key||y||(y=!0,v=!1);switch(e.key){case"Escape":document.getElementById("sdmcd-popup-bg")?document.getElementById("sdmcd-popup-bg").remove():(document.sdmcd=!1,F());break;case"e":g.push({data:s.getImageData(0,0,o.width,o.height)}),w?(s.fillStyle="#FFFFFF",s.fillRect(0,0,o.width,o.height),S()):s.clearRect(0,0,o.width,o.height),f=[];break;case"s":if(e.ctrlKey){const e=o.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="drawing.png",t.click()}else c=5,l=5,s.lineWidth=5,R();break;case"w":r="#FFFFFF";break;case"b":r="#000000";break;case"r":r="#FF0000";break;case"g":r="#00FF00";break;case"l":r="#0000FF";break;case"o":r="#FFA500";break;case"p":r="#800080",L();break;case"m":r="#FF00FF";break;case"a":r="#00FFFF";break;case"c":if(m||u)break;t=document.getElementById("sdmcd-popup-bg"),t?t.remove():function(){const e=z(),t=document.createElement("div");t.id="sdmcd-color-content",e.appendChild(t);const n=document.createElement("input");n.id="sdmcd-color",n.type="color",n.value=r,n.addEventListener("change",(e=>{r=e.target.value,S()})),t.textContent="Color:",t.appendChild(n)}();break;case"ArrowUp":c+=1,s.lineWidth=c,l=c,R();break;case"ArrowDown":c-=1,c<1&&(c=1),s.lineWidth=c,l=c,R();break;case"f":h=!h,h?(p=!1,document.body.classList.add("sdmcd-unfocused"),P()):(document.body.classList.remove("sdmcd-unfocused"),B());break;case"F1":p=!p,p?(h=!1,document.body.classList.add("sdmcd-hidden"),document.body.classList.remove("sdmcd-unfocused"),P()):(document.body.classList.remove("sdmcd-hidden"),B());break;case"z":if(e.ctrlKey){const e=s.getImageData(0,0,o.width,o.height),t=g.pop();if(!t)break;if(t.switch&&D(!1),t.data&&s.putImageData(t.data,0,0),t.activeTextInputs){for(const e of t.activeTextInputs){document.getElementById(e).classList.remove("removed")}f.push({data:e,activeTextInputs:t.activeTextInputs,switch:t.switch})}else if(t.textId){document.activeElement.blur();const n=document.getElementById(t.textId);t.text?(f.push({data:e,textId:t.textId,text:n.textContent}),n.textContent=t.text):(f.push({data:e,textId:t.textId}),n.classList.toggle("removed"))}else f.push({data:e,switch:t.switch})}break;case"y":if(!e.ctrlKey){r="#FFFF00";break}{const e=s.getImageData(0,0,o.width,o.height),t=f.pop();if(!t)break;if(t.switch&&D(!1),t.data&&s.putImageData(t.data,0,0),t.activeTextInputs){for(const e of t.activeTextInputs){document.getElementById(e).classList.add("removed")}g.push({data:e,activeTextInputs:t.activeTextInputs,switch:t.switch})}else if(t.textId){document.activeElement.blur();const n=document.getElementById(t.textId);t.text?(g.push({data:e,textId:t.textId,text:n.textContent}),n.textContent=t.text):(g.push({data:e,textId:t.textId}),n.classList.toggle("removed"))}else g.push({data:e,switch:t.switch})}break;case"t":D(!0);break;case"R":x=1;break;case"C":x=2;break;case"h":if(m||u)break;t=document.getElementById("sdmcd-popup-bg"),t?t.remove():function(){const e=z(),t=document.createElement("div");t.id="sdmcd-help-bg",e.appendChild(t);const n=document.createElement("div");n.id="sdmcd-help-left",n.innerHTML="<h3>General</h3>",t.appendChild(n);const d=document.createElement("div");d.id="sdmcd-help-right",d.innerHTML="<h3>Colors</h3>",t.appendChild(d);[[1,"Left Click","Draw"],[1,"Right Click","Erase"],[1,"Middle Click","Add text"],[1],[1,"Shift","Switch to freehand"],[1,"Shift + R","Switch to rectangle"],[1,"Shift + C","Switch to circle"],[1,"Shift + Click","Fill color"],[1],[1,"E","Erase canvas"],[1,"T","Toggle whiteboard mode"],[1,"Shift + Scroll","Change brush size"],[1],[1,"F","Focus page content"],[1,"F1","Hide drawing"],[1],[1,"Ctrl + Z","Undo"],[1,"Ctrl + Y","Redo"],[1,"Ctrl + S","Save as image"],[1],[1,"H","Show keybinds"],[1,"Esc","Close modal / Exit drawing"],[2,"W","White"],[2,"B","Black"],[2,"R","Red"],[2,"G","Green"],[2,"L","Blue"],[2,"Y","Yellow"],[2,"O","Orange"],[2,"P","Purple"],[2,"M","Magenta"],[2,"A","Aqua"],[2],[2,"C","Custom color"]].forEach((([e,t,i])=>{const a=document.createElement("div");a.classList.add("sdmcd-help-line"),t&&i&&(t=t.split(" + ").map((e=>`<code>${e}</code>`)).join(" + "),a.innerHTML=`<span>${t}</span><span>${i}</span>`),1===e?n.appendChild(a):d.appendChild(a)}))}();break;default:n=!1}S(),L(),n&&(e.preventDefault(),e.stopPropagation())}),{capture:!0,signal:document.sdmcdKeyAborter.signal}),window.addEventListener("keyup",(function(e){"Shift"===e.key&&(v||(x=0),y=!1,L())}),{capture:!0,signal:document.sdmcdKeyAborter.signal})):F()}();